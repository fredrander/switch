<html>
	<head>
		<style>
			img {
				max-width: 90%;
				max-height: 90%;
				margin-left: auto;
				margin-right: auto;
				display: block;
			}
			.settingstext {
				font-size: 1em;
				color: #729fcf;
				font-family: Arial;
				text-shadow: #d6e3f1 0 0 2px;
				text-align: left;
				font-weight: normal;
				line-height: 175%;
				margin-top: 2em;
				margin-left: 2em;
			}
		</style>
	</head>
	<body style="background-color:#181818">
		<div style="width=100%; height=100%;">
			<form class="settingstext" id="settingsform">
				Enable timer at sunrise:
				<input id="sunriseenable" type="checkbox"/>
				<br/>
				Start at sunrise, Mon:
				<input id="sunrisestart_mon" type="time"/>
				Tue:
				<input id="sunrisestart_tue" type="time"/>
				Wed:
				<input id="sunrisestart_wed" type="time"/>
				Thu:
				<input id="sunrisestart_thu" type="time"/>
				Fri:
				<input id="sunrisestart_fri" type="time"/>
				Sat:
				<input id="sunrisestart_sat" type="time"/>
				Sun:
				<input id="sunrisestart_sun" type="time"/>
				<br/>
				Stop at sunrise - offset in minutes from sunrise:
				<input id="sunrisestop" type="number"/>
				<br/>
				<br/>
				Enable timer at sunset:
				<input id="sunsetenable" type="checkbox"/>
				<br/>
				Start at sunset - offset in minutes from sunset:
				<input id="sunsetstart" type="number"/>
				<br/>
				Stop at sunset, Mon:
				<input id="sunsetstop_mon" type="time"/>
				Tue:
				<input id="sunsetstop_tue" type="time"/>
				Wed:
				<input id="sunsetstop_wed" type="time"/>
				Thu:
				<input id="sunsetstop_thu" type="time"/>
				Fri:
				<input id="sunsetstop_fri" type="time"/>
				Sat:
				<input id="sunsetstop_sat" type="time"/>
				Sun:
				<input id="sunsetstop_sun" type="time"/>
				<br/>
				<br/>
				Time zone:
				<input id="timezone" type="text"/>
				<br/>
				Latitude:
				<input id="latitude" type="number" step="any"/>
				Longitude:
				<input id="longitude" type="number" step="any"/>
				<br/>
				<br/>
				<button type="submit">Ok</button>
			</form>
			
			<p id="dbg"></p>
		</div>
		<script>
			function rspGetSettings() {
				rspStr = JSON.parse(this.responseText);
				var rsp = rspStr.split( ";" );
				var rspDict = {};
				for ( i = 0; i < rsp.length; i++ ) {
					var rspKeyValue = rsp[ i ].split( "=" );
					if ( rspKeyValue.length > 1 ) {
						rspDict[ rspKeyValue[ 0 ] ] = rspKeyValue[ 1 ];
					}
				}

				//document.getElementById("dbg").innerHTML = dbg;

				document.getElementById("sunriseenable").checked = (rspDict[ "SUNRISE" ] == "TRUE");
				document.getElementById("sunrisestart_mon").value = rspDict[ "SUNRISE_ON_MON" ];
				document.getElementById("sunrisestart_tue").value = rspDict[ "SUNRISE_ON_TUE" ];
				document.getElementById("sunrisestart_wed").value = rspDict[ "SUNRISE_ON_WED" ];
				document.getElementById("sunrisestart_thu").value = rspDict[ "SUNRISE_ON_THU" ];
				document.getElementById("sunrisestart_fri").value = rspDict[ "SUNRISE_ON_FRI" ];
				document.getElementById("sunrisestart_sat").value = rspDict[ "SUNRISE_ON_SAT" ];
				document.getElementById("sunrisestart_sun").value = rspDict[ "SUNRISE_ON_SUN" ];
				document.getElementById("sunrisestop").value = rspDict[ "SUNRISE_OFF_DIFF_MINUTES" ];

				document.getElementById("sunsetenable").checked = (rspDict[ "SUNSET" ] == "TRUE");
				document.getElementById("sunsetstop_mon").value = rspDict[ "SUNSET_OFF_MON" ];
				document.getElementById("sunsetstop_tue").value = rspDict[ "SUNSET_OFF_TUE" ];
				document.getElementById("sunsetstop_wed").value = rspDict[ "SUNSET_OFF_WED" ];
				document.getElementById("sunsetstop_thu").value = rspDict[ "SUNSET_OFF_THU" ];
				document.getElementById("sunsetstop_fri").value = rspDict[ "SUNSET_OFF_FRI" ];
				document.getElementById("sunsetstop_sat").value = rspDict[ "SUNSET_OFF_SAT" ];
				document.getElementById("sunsetstop_sun").value = rspDict[ "SUNSET_OFF_SUN" ];
				document.getElementById("sunsetstart").value = rspDict[ "SUNSET_ON_DIFF_MINUTES" ];
			
				document.getElementById("timezone").value = rspDict[ "TIME_ZONE" ];
				document.getElementById("latitude").value = rspDict[ "LATITUDE" ];
				document.getElementById("longitude").value = rspDict[ "LONGITUDE" ];
			}

			function reqGetSettings() {
				var req = new XMLHttpRequest();
				req.addEventListener("load", rspGetSettings);
				req.open("GET", "getsettings.php", true);
				req.send();
			}

			function handleOk( e ) {
				
				var reqDict = {};				
				
				if ( document.getElementById("sunriseenable").checked ) {
					reqDict[ "SUNRISE" ] == "TRUE";
				} else {
					reqDict[ "SUNRISE" ] == "FALSE";
				}
				reqDict[ "SUNRISE_ON_MON" ] = document.getElementById("sunrisestart_mon").value;
				reqDict[ "SUNRISE_ON_TUE" ] = document.getElementById("sunrisestart_tue").value;
				reqDict[ "SUNRISE_ON_WED" ] = document.getElementById("sunrisestart_wed").value;
				reqDict[ "SUNRISE_ON_THU" ] = document.getElementById("sunrisestart_thu").value;
				reqDict[ "SUNRISE_ON_FRI" ] = document.getElementById("sunrisestart_fri").value;
				reqDict[ "SUNRISE_ON_SAT" ] = document.getElementById("sunrisestart_sat").value;
				reqDict[ "SUNRISE_ON_SUN" ] = document.getElementById("sunrisestart_sun").value;
				reqDict[ "SUNRISE_OFF_DIFF_MINUTES" ] = document.getElementById("sunrisestop").value;

				if ( document.getElementById("sunsetenable").checked ) {
					reqDict[ "SUNSET" ] == "TRUE";
				} else {
					reqDict[ "SUNSET" ] == "FALSE";
				}
				reqDict[ "SUNSET_OFF_MON" ] = document.getElementById("sunsetstop_mon").value;
				reqDict[ "SUNSET_OFF_TUE" ] = document.getElementById("sunsetstop_tue").value;
				reqDict[ "SUNSET_OFF_WED" ] = document.getElementById("sunsetstop_wed").value;
				reqDict[ "SUNSET_OFF_THU" ] = document.getElementById("sunsetstop_thu").value;
				reqDict[ "SUNSET_OFF_FRI" ] = document.getElementById("sunsetstop_fri").value;
				reqDict[ "SUNSET_OFF_SAT" ] = document.getElementById("sunsetstop_sat").value;
				reqDict[ "SUNSET_OFF_SUN" ] = document.getElementById("sunsetstop_sun").value;
				reqDict[ "SUNSET_ON_DIFF_MINUTES" ] = document.getElementById("sunsetstart").value;
			
				reqDict[ "TIME_ZONE" ] = document.getElementById("timezone").value;
				reqDict[ "LATITUDE" ] = document.getElementById("latitude").value;
				reqDict[ "LONGITUDE" ] = document.getElementById("longitude").value;

				var postData = "settings=SETTINGS"
				for ( var key in reqDict ) {
					if ( reqDict.hasOwnProperty( key ) ) {
						postData += ";";
						postData += key;
						postData += "=";
						postData += reqDict[ key ];
					}
				}

				var req = new XMLHttpRequest();
				req.open("POST", "setsettings.php", true);
				req.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
				req.send(postData);

				return false;
			}
			
			window.onload=function() {
				var form = document.getElementById("settingsform");
				if (form.attachEvent) {
					form.attachEvent("submit", handleOk);
				} else {
					form.addEventListener("submit", handleOk);
				}
				reqGetSettings();
			}
		</script>
	</body>

</html>

